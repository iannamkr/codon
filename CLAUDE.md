# CLAUDE.md

## 프로젝트 개요

**Codon** — 유전자 교배 전투 게임.

> 12칸 DNA 서열에 Gene을 배치하고, 코돈 패턴과 효소(조커)로 시너지를 짜고, 출격해서 Gene 1:1 전투를 하고, 연구실로 돌아와 잠긴 서열 사이에 새 Gene을 삽입하며 빌드를 다듬고, 결정화되면 은퇴시켜 다음 세대를 이어간다.

### 핵심 설계 원칙

| 원칙 | 설명 |
|------|------|
| 생물학 기반 | 실제 DNA 코돈 테이블을 게임 시스템으로 직접 차용 |
| PoE급 빌드 깊이 | 40종 일체형 Gene × 12칸 배치 × 효소 시너지 = 무한 빌드 |
| 심플 + 중독 | 한 출격 3~5분. "한 판만 더" |
| 아트 최소화 | 카드 아트 + 코드 이펙트. 에셋 제작 최소 |
| 세계관 = 연구실 | 스토리 없음. 실험체. 블랙유머 톤 |

## 현재 상태

- **단계**: 시스템 설계
- **플랫폼**: WebView (Phaser)
- **기술 스택**: TypeScript + Phaser + Vite

## 확정된 설계

### 용어 재정의 — 패턴 패러다임 (009 확정)

코돈은 "Gene을 담는 컨테이너"가 아니라 "Gene 배열에서 읽히는 무형의 패턴"으로 전환.
컨테이너 계층(Gene→Codon→Sequence→Build)이 사라지고, **Gene 서열이 유일한 물리적 실체**.

| 용어 | 정의 | 성격 |
|------|------|------|
| **Gene** (유전자) | 전장에 배치, 1:1 전투, 소멸/보존되는 물리적 블록. 하위 효과 내장 (일체형 아이템) | 물리 |
| **DNA Chain** (서열) | 12개 Gene이 이어진 하나의 전장 | 물리 |
| **Codon** (코돈/족보) | 3개 Gene이 만드는 패턴. 아미노산 기본 패시브 제공 | 무형 |
| **효소/조커** (Enzyme) | 연구실에서 장착하는 패턴 인식 트리거. 코돈 패턴을 인식하여 강력한 효과 발동 | 장비 |

```
DNA Chain (12칸 서열)    [Gene][Gene][Gene] [Gene][Gene][Gene] [Gene][Gene][Gene] [Gene][Gene][Gene]
                          ─── 코돈 1 ───   ─── 코돈 2 ───   ─── 코돈 3 ───   ─── 코돈 4 ───
                               ↓ 패턴 인식
효소 (조커 4개)           [효소1][효소2][효소3][효소4]  ← 조건 매칭 시 강력한 효과 발동
```

### Gene (유전자) = 일체형 아이템 (Integrated Gene)

- **A, T, G, C** — 4종류의 염기. 게임의 기본 블록
- 각 Gene에는 **하위 Gene 10종**이 존재 (총 40종)
- **Gene = 하위 효과가 내장된 완성품 아이템**: `[강타하는 A]`, `[은신하는 C]` 등
- 배치 시 드래그 앤 드롭 1회로 끝 (2단계 선택 아님)
- 코돈 판정: 베이스(A/T/G/C)만 읽음. 하위 효과는 전투 판정에서 개별 적용
- 하위 Gene 목록:
  - A(파괴): 강타/폭발/관통/침식/약화/처형/희생/선제/파쇄/과부하
  - T(생존): 보호/회복/반격/흡혈/장벽/인내/은신/적응/정화/공생
  - G(질서): 가속/정밀/안정/지속/집중/억제/공명/환경/결속/선독
  - C(혼돈): 폭주/전파/왜곡/연쇄/도발/복제/잠식/역전/기생/분열

### Codon (코돈) = 패턴 + 아미노산 기본 패시브

- Gene 3개가 만드는 **무형의 패턴** (컨테이너 아님)
- 4³ = **64개** 코돈 조합 가능
- 64개 코돈 → **20개 아미노산**(효과 그룹)으로 매핑 (생물학 코돈 테이블 그대로)
- **모든 코돈은 기본 패시브(아미노산 효과)를 제공** — 조커 없이도 "꽝"이 아님
  - A 다수 = 공격형 아미노산, T 다수 = 방어형, G 다수 = 제어형, C 다수 = 교란형
  - 생물학의 코돈 중복성(Redundancy) 그대로 활용
- 희귀도 = 경로 수:
  - 1경로 (ATG=메티오닌, TGG=트립토판): 초희귀, 강력
  - 2경로: 조건부 강력
  - 4경로: 안정적, 범용
  - 6경로 (류신, 세린, 아르기닌): 가장 흔함, 기본 유틸
- 정지 코돈 (TAA, TAG, TGA): 스킬 비활성화 (위험/의도적 활용)

### 효소/조커 (Enzyme) = 패턴 인식 트리거

- 연구실에서 **4개 장착**, 전투 중 불변
- **전투 후 잠기지 않음** — 매 전투 전 자유 교체 (Gene만 잠김)
- 코돈(아미노산) 기본 패시브 위에 **강력한 증폭/변형 효과** 부여
- 3가지 트리거 카테고리:

| 카테고리 | 인식 대상 | 예시 |
|---------|----------|------|
| **패턴 인식형** | 특정 코돈(아미노산) 완성 | "기폭(ATG) 코돈 시 기본 +10% → +50%로 증폭" |
| **조건 인식형** | 윈도우 내 특정 Gene/상태 | "3칸 안에 A 존재할 때마다 체력 5 회복" |
| **이벤트 인식형** | 전투 결과/프레임시프트 | "내 Gene이 적을 파괴하고 생존 시 다음 공격력 2배" |

- 구체적 효소 26종 확정: `docs/design/011-enzyme-effects.md`
  - 🔴 Destroy 6종: 농축 발화 촉매제, 골수 추출 피펫, A-스테로이드 앰플, 한계 돌파 자극기, 피의 펌프 모터, CRISPR 절단 가위
  - 🟢 Survive 6종: 경화 수지 스프레이, 세포 분열 억제제, T-항체 배양액, 극저온 동결 캡슐, 충격 흡수 겔, 제세동기
  - 🔵 Order 6종: 신경망 오버라이드 칩, 위상 교정 렌즈, G-시냅스 연결선, DNA 시퀀스 스캐너, 리듬 조율 마이크로칩, 형태 유지 프레임
  - 🟣 Chaos 6종: 돌연변이 안정제, 불안정 동위원소, C-환각 주입기, 폐기물 재활용 분쇄기, 유전자 재조합 칵테일, 망각의 플라시보
  - 💀 Stop 2종: 괴사 조직 배양액, 사체 방부 처리제

### 2레이어 효과 구조

```
레이어 1: 족보 (빌드 시 확정, 전투 내내 유지)
───────────────────────────────────
빌드 시점에 12 Gene 배열 → 고정 윈도우로 4코돈 읽음
이 4코돈이 "족보" = 전투 내내 유지되는 글로벌 패시브 효과
전투 중 프레임시프트가 일어나도 족보는 변하지 않음

레이어 2: 코돈 효과 (전투 중 3라운드마다 재평가)
───────────────────────────────────
전투 중 Gene이 소멸되면 서열 당김(프레임시프트) 발생
3라운드마다 남은 Gene을 다시 3개씩 읽음 → 새로운 코돈 효과(아미노산) 발현
효소(조커)도 이 시점에 재판정
```

### 전투 시스템 — Gene 1:1 전투 (12 vs 12)

- **전투 단위**: 12 Gene vs 12 Gene (항상 동일 스케일)
- **상성**: 순환 — **A(파괴) > T(생존) > G(질서) > C(혼돈) > A**
- **전투 종료 조건**: Gene 전소 OR HP 0 (둘 중 하나)

#### 기본 규칙 — 동종 돌파 / 이종 교대

1. Gene이 1:1로 싸움 (앞에서부터 순서대로)
2. 상성 우위 쪽이 승리 → 패배한 Gene 소멸
3. 승리한 Gene은 전장에 생존
4. 다음 내 Gene이 **동종**이면 → **돌파** (합체하여 진화, A+A=A⁺). 깡스탯 상승
5. 다음 내 Gene이 **이종**이면 → **교대** (생존 Gene이 Survivor Pool로 퇴장, 다음 Gene 출전)
6. 동등(같은 Gene)이면 → 양쪽 보존, 다음 Gene으로 넘어감 (데미지 없음)

#### 페이즈 진행 (3라운드 = 1페이즈)

```
1. [스캔]     시스템이 현재 윈도우(3칸) 스캔 → 코돈 패턴 판정
2. [아미노산]  코돈의 기본 패시브(아미노산) 효과 발동
3. [효소 개입]  장착한 효소 4개가 조건 체크 → 매칭 시 강력한 효과 발동
4. [전투]     3라운드 동안 Gene 1:1 전투 (상성 + 하위 효과 적용)
5. [시프트]    소멸/생존 처리 → 프레임시프트 → 다음 윈도우 스캔
```

#### 전투 시뮬레이션 예시

```
[A₁][A₂][G₃][T₄] vs [T₁][C₂][A₃][G₄]

R1: A₁ vs T₁ → A₁ 승리 (A>T), A₁ 생존
    다음 내 Gene: A₂ (동종) → 돌파!

R2: A₁+A₂ = A⁺ vs C₂ → A⁺ 승리, A⁺ 생존
    다음 내 Gene: G₃ (이종) → 교대
    A⁺ → Survivor Pool. G₃ 출전

R3: G₃ vs A₃ → G₃ 패배 (A>G), G₃ 소멸
    적 A₃ 생존, 다음 적 Gene: G₄ (이종) → 교대
    적 A₃ → 적 Survivor Pool. 적 G₄ 출전

R4: T₄ vs 적 G₄ → T₄ 승리 (T>G)
    내 Gene 소진 → 전투 종료

결과:
내 Survivor Pool: [A⁺], [T₄]
내 소멸: [G₃]
```

### 빌드 구조 — 12칸 서열 + 효소 4개

- **빌드 = 12 Gene 배치 + 효소(조커) 4개 장착**
- 연구실에서 확정. 전투 중 수정 불가 (효소는 전투 후 자유 교체)
- 빌드 순서:
  1. 실험체 선택 (잠긴 Gene 확인)
  2. 빈 칸에 Gene 배치 (인벤토리에서 드래그 앤 드롭)
  3. 효소(조커) 4개 장착
  4. 족보(고정 윈도우 4코돈) 확인 + 코돈 효과 프리뷰
  5. 출격

### 실험체 — 12칸 결정화 (Crystallization)

Gene 총량은 **항상 12칸 고정**. 잠긴 Gene의 밀도가 성장과 노화의 척도.

```
탄생 (1전투):  [○][○][○][○][○][○][○][○][○][○][○][○]  자유 12칸. 유연성 100%
성장 (2~3전투): [★][★][★][★][○][○][○][○][○][○][○][○]  잠김 4 + 자유 8. 퍼즐 최고조
노화 (4~5전투): [★][★][★][★][★][★][★][★][★][★][○][○]  잠김 10 + 자유 2. 깡스탯↑ 유연성↓
결정화 (최종):  [★][★][★][★][★][★][★][★][★][★][★][★]  잠김 12. 은퇴
```

- **CRISPR/Splicing**: 전투 후 생존 Gene은 잠긴 상태로 압축 귀환. 소멸된 자리(빈 칸)에 새 Gene을 삽입
- **잠긴 Gene**: 위치 이동/제거/교체 불가
- **결정화된 실험체**: 깡스탯은 역대급이지만 코돈 시너지 조정 불가
  - 극악 보스전에 투입 (명예로운 죽음)
  - 또는 은퇴시켜 메타 재화(플라스미드 등) 추출
- 열화/세대교체가 별도 시스템 없이 자연 발생

### ATGC 역할 — 순환 상성

- **순환 상성**: A(파괴) > T(생존) > G(질서) > C(혼돈) > A(파괴)
- 역할명(파괴/생존/질서/혼돈)은 유지, 상성 관계만 순환
- 서사 해석:
  - 파괴 > 생존: 파괴가 생존을 부순다
  - 생존 > 질서: 압도적 생명력이 체계를 무시한다
  - 질서 > 혼돈: 체계가 혼란을 억제한다
  - 혼돈 > 파괴: 예측불가능이 파괴를 무력화한다

```
A(파괴) ──> T(생존)
  ↑              │
  │              ↓
C(혼돈) <── G(질서)
```

| 염기 | 역할 | 이기는 상대 | 지는 상대 | 하위 Gene 방향 |
|------|------|-----------|-----------|---------------|
| **A** (아데닌) | 파괴 | T | C | 데미지, 관통, 약화 계열 |
| **T** (티민) | 생존 | G | A | 방어, 회복, 보호 계열 |
| **G** (구아닌) | 질서 | C | T | 속도, 정밀, 안정 계열 |
| **C** (시토신) | 혼돈 | A | G | 변이, 크리, 교란 계열 |

### 코돈 역할 태그 — ATGC 역할과 동일

| 태그 | 역할 | 예시 아미노산 효과 |
|------|------|-------------------|
| **Destroy** | 파괴 | 기폭, 폭발, 침식, 관통 등 |
| **Survive** | 생존 | 경화, 재생, 반사, 결합 등 |
| **Order** | 질서 | 가속, 강직, 적응, 환경지배 등 |
| **Chaos** | 혼돈 | 반격, 변이촉발 등 |

### PoE 대응

| 우리 시스템 | PoE 대응 | 역할 |
|------------|---------|------|
| **Gene** (일체형 아이템) | Skill Gem + Support Gem | 물리적 전투 블록 + 하위 효과 내장 |
| **Codon** (패턴) | Skill Tag / Combo | 3 Gene 패턴 → 아미노산 기본 패시브 |
| **효소/조커** (4개 장착) | Jewel / Keystone | 패턴 인식 → 강력한 증폭 효과 |
| **DNA Chain** (12칸 서열) | Loadout / Deck | 전투 세팅 전체 |
| **Plasmid (플라스미드)** | Ascendancy | 규칙 파괴형 — 코어 룰 변경 (미설계) |
| **Expression Tree (발현 트리)** | Passive Tree | 빌드 특화 (TBD) |
| **Lab Item (연구실 아이템)** | Equipment | 장비 (TBD) |

### 게임 구조 — 하이브리드 (영속 연구실 + 짧은 출격)

- **로그라이크 아님**: Hades식 하이브리드. 영속 연구실 + 짧은 출격(3~5분)
- **코어 루프**: 연구실에서 빌드 → 출격(전투) → 귀환 → 잠긴 서열에 Splicing → 효소 재조정 → 교배 → 새 실험체 → 반복
- PoE의 "마을↔맵" = 우리의 "연구실↔출격"
- 빌드 반복이 핵심 재미: 출격 결과(잠긴 Gene, 프레임시프트)를 보고 돌아와서 효소/배치를 조정
- **파밍 동기**: PoE식 옵션 타협 거부 — "3번 자리에 꽂을 [흡혈하는 A]가 뜰 때까지 합성/배양 노가다"

### 빌드 깊이 — 다층 빌드 시스템

- **Layer 0: 플라스미드 (키스톤)** — 코어 룰 파괴/변형 (미설계, 역설계 예정)
- **Layer 1: Gene 배치** — 12칸에 어떤 일체형 Gene을 어디에 배치할 것인가 (상성 + 하위 효과 + 코돈 패턴)
- **Layer 2: 효소(조커)** — 4개 효소로 코돈 패턴을 어떻게 증폭할 것인가
- **Layer 3: 발현 트리 (패시브)** — 빌드 방향 (TBD)
- **Layer 4: 연구실 장비 (아이템)** — 특수 효과 (TBD)

### 스탯 (Stat) — 기본 3 + 고유 1

- PoE2식 기본 스탯 + 우리 게임 고유 스탯 1개
- **힘 (STR)** → HP, 데미지
- **민첩 (DEX)** → SPD, 선공
- **내성 (RES)** → DEF, 속성 저항
- **변이 (MUT)** → 전투 중 변이 횟수, 크리티컬, 변이 품질. Mewgenics의 Luck에 대응하되 생물학 테마

### 체질 (Attribute) — 공식 계수 변경 (`014-attribute-system.md`)

체질 = 스탯 파생 공식의 **계수(기울기)**를 변경하는 선천 고정 특성. 6종, 혼합 불가.

| 체질 | HP 계수 | 데미지 계수 | SPD 계수 | DEF 계수 | MUT 분모 | 빌드 성격 |
|------|--------|-----------|---------|---------|---------|----------|
| **균형** | STR×2.0 | STR×0.10 | DEX×0.5 | RES×0.30 | 100 | 범용 |
| **맹공** | STR×1.5 | STR×0.18 | DEX×0.5 | RES×0.20 | 100 | 글래스캐논 |
| **철벽** | STR×2.5 | STR×0.05 | DEX×0.4 | RES×0.45 | 100 | 탱 |
| **신속** | STR×1.5 | STR×0.10 | DEX×0.8 | RES×0.30 | 100 | 선공 제압 |
| **재생** | STR×2.5 | STR×0.10 | DEX×0.3 | RES×0.30 | 100 | 장기전 |
| **변이** | STR×2.0 | STR×0.10 | DEX×0.5 | RES×0.20 | 70 | 카오스 |

- **유전 + 환경**: 부모 체질로 후보 풀 제공 → 연구실에서 유저가 "주입"으로 최종 선택
- 체질은 탄생 시 확정, 영구 고정 (변경 불가)
- 키스톤급 특수 효과는 체질이 아닌 **발현 트리 최종 노드**에서 제공 예정

### 속성 — 4속성 + 약한 상성 + 고유 효과

- PoE식 고유 효과 + 포켓몬식 약한 상성 혼합
- 상성 배율은 낮게 (~1.2배) → 빌드 실력이 상성을 이길 수 있음
- 속성은 플라스미드를 통해 코돈에 부여됨 (Gene 자체에는 속성 없음)

| 속성 | 고유 효과 | 강함 (+20%) | 약함 (-20%) |
|------|----------|------------|------------|
| **Fire** | 점화 (지속 데미지) | vs Plant | vs Water |
| **Water** | 둔화 (SPD 감소) | vs Fire | vs Earth |
| **Earth** | 경화 (DEF 증가) | vs Water | vs Plant |
| **Plant** | 재생 (HP 회복) | vs Earth | vs Fire |

```
Fire > Plant > Earth > Water > Fire (약한 상성)
각 속성은 고유 효과로 전략 차별화
```

### Plasmid (플라스미드) = 빌드 키스톤 ⚠️ 재설계 보류

- **빌드의 첫 번째 선택**. 플라스미드가 코어 룰(상성/프레임시프트/윈도우/결정화)을 변경
- **규칙 파괴형**: "X를 포기/변경하는 대신 Y를 얻는다"
- **현재 상태**: 기존 12종은 구 전투 시스템(4페이즈/시퀀스) 기반이므로 대부분 무효
- **재설계 방침**: C안 — 코돈(아미노산) 효과 + 효소 목록 확립 후 역설계
  - "기본 규칙이 100% 견고하게 세워지기 전에, 규칙 파괴자를 먼저 만들면 게임이 산으로 간다"
  - 유저 선호 콤보 파악 → 그 콤보를 비트는 플라스미드 역설계 = 버려지는 플라스미드 0

### 빌드 UI — 데이터 표시 가이드

개발 시 빌드 화면 구성:

```
════════════════ 연구실 빌드 화면 ════════════════

[🔴농축 발화 촉매제]  [🟢극저온 동결 캡슐]  [🟣폐기물 분쇄기]  [💀괴사 조직 배양액]
  🧬 패턴 인식          🧪 조건 인식           🧪 조건 인식       🧪 조건 인식

┌─────────────── DNA Chain (12칸) ───────────────┐
│ [강타A] [폭발A] [보호T]  [가속G] [정밀G] [폭주C]  [흡혈T] [반격T] [왜곡C]  [관통A] [장벽T] [연쇄C] │
│  ──코돈1(AAT)──   ──코돈2(GGC)──   ──코돈3(TTC)──   ──코돈4(ATC)──  │
│  근력 아미노산      안정 아미노산      방어 아미노산      침투 아미노산   │
└───────────────────────────────────────────────┘

족보 (전투 내내 고정): 근력/안정/방어/침투
효소 매칭: 촉매제 → 코돈1에 파괴 아미노산! 치명타 30% 발동
           분쇄기 → 잠긴 Gene 3개 → 데미지 +30%
           배양액 → 코돈3이 Stop! → 적 HP 20% 고정 딜
```

표시 항목:
- 12칸 Gene: Gene 타입 + 하위 효과 아이콘
- 4개 코돈 패턴: 3칸씩 구분선 + 아미노산 이름 + 기본 패시브 효과
- 효소 4개: 트리거 조건 + 매칭 상태
- 족보: 빌드 시 확정된 4코돈 = 전투 내내 유지되는 고정 패시브
- 잠긴 Gene: ★ 표시 (수정 불가)

### HP & 데미지 시스템 — 듀얼 트랙 (`012-combat-formulas.md`)

Gene ATK과 HP 데미지를 완전히 분리:

| 트랙 | 용도 | 공식 |
|------|------|------|
| **Gene ATK** | 동종 대결(A vs A) 승패 판정 | 기본 10 + 하위Gene 보정(0~5) |
| **HP 데미지** | 본체 HP 감소 | 기본 10 + 아미노산/효소 보정 |
| **HP** | 본체 체력 | 80 + (STR × 2) |

### 동종 진화 — ×1.5 + 옵션 병합

- `A⁺ ATK = max(A₁, A₂) × 1.5`
- **핵심: 하위Gene 옵션 2개를 한 몸에 병합** (예: [흡혈+강타 A⁺])
- 하위Gene 최대 2개. 융합 점균(아미노산) 장착 시 3개까지 돌파

### Survivor Pool — 꼬리 귀환 (Tail Append)

- 생존 Gene은 서열 맨 끝으로 이동 → 서열 순환 → 프레임시프트 자연 발생
- **탈진 데미지**: 서열 1회전 완료마다 양쪽 HP -= (순환 횟수 × 5). 전투 자연 종료 보장

### 변이 시스템 — 5등급 변이 풀 (`013-mutation-system.md`)

전투 중 MUT 스탯 기반 돌연변이 팝업 → 유저 수락/거부 → 수락 시 영구 잠김:

| 등급 | 변이 | 요구 MUT | 트리거 | 효과 |
|------|------|---------|--------|------|
| 흔함 | 점변이 | 10+ | 페이즈 전환 | Gene 타입 변경 (A→T) |
| 보통 | 역위 | 30+ | 탈진 데미지 | 윈도우 3칸 순서 반전 |
| 희귀 | 전위 | 50+ | 프레임시프트 | Gene 2개 위치 교환 |
| 영웅 | 중복 | 70+ | Gene 파괴 | 인접 Gene 복사로 파괴 방지 |
| 전설 | 키메라 | 90+ | 상성 승리 | 적 Gene 흡수 → 이중 타입 생성 |

MUT 3축 제어: 빈도(확률), 품질(등급 가중치), 선택지 수(크리티컬)
상한 없음 — 12칸 잠김이 소프트 캡. 잠긴 Gene도 변이 대상(구원줄).

### 플라스미드 12종 (`015-plasmid-redesign.md`)

빌드의 첫 선택. "X를 포기 → Y를 획득" 규칙 파괴형. 빌드당 1개.

| # | 이름 | 파괴 규칙 | 포기 | 획득 |
|---|------|---------|------|------|
| 1 | 역행 | 스캔 방향 | 정방향 배치 | 역순 스캔(뒤→앞) |
| 2 | 과성장 | 윈도우 크기 | 기본 데미지 0 | 4칸 Tetrad, 색상 매칭 시 ×3 |
| 3 | 무속성 | 상성 존재 | 상성 판정 | ATK 비교 + 기본 데미지 +5 |
| 4 | 과부하 | 서열 크기 | 탈진 ×2 | 16칸 서열 |
| 5 | 역류 | 귀환 방향 | 귀환마다 HP -2 | 머리 귀환(에이스 재활용) |
| 6 | 재조합 | 잠김 규칙 | 교체마다 HP -5 | 잠긴 Gene 교체 가능 |
| 7 | 불안정 서열 | 변이 수락/거부 | 거부 불가 | 변이 2배 + 선택지 +1 |
| 8 | 순수 서열 | 변이 존재 | 변이 전체 비활성 | 스탯 파생 +20% |
| 9 | 적응체 | 변이 영구성 | 효과 ×0.5 | 비영구(귀환 시 원복) |
| 10 | 반전체 | 상성 방향 | 정상 상성 | 역상성 A<T<G<C<A |
| 11 | 잠복 | 전투 타이밍 | 6라운드 패시브 비활성 | 축적 버프 일괄 폭발 |
| 12 | 기생체 | 상대 플라스미드 | 자체 능력 없음 | 상대 플라스미드 탈취 |

### 미확정 (논의 필요)
- 수집/자랑 요소: PoE 유니크 아이템에 대응하는 수집 요소
- 크래프팅: 교배 자체를 크래프팅으로 볼 것인지, 별도 시스템 필요한지
- Expression Tree: 미설계
- Lab Item: 미설계

## 설계 진행 상황

| 카테고리 | 상태 |
|----------|------|
| Gene (일체형 아이템 모델) | ✅ 확정 (A/T/G/C 4종 × 하위 Gene 10종 = 40종) |
| Codon (패턴 + 아미노산 기본 패시브) | ✅ 확정 — 20종 아미노산 패시브 설계 완료 (`docs/design/010-amino-acid-passives.md`) |
| 효소/조커 (3트리거 카테고리) | ✅ 확정 — 26종 효소 설계 완료 (`docs/design/011-enzyme-effects.md`) |
| 2레이어 효과 구조 (족보 + 코돈 효과) | ✅ 확정 |
| 전투 시스템 (Gene 1:1, 동종돌파/이종교대) | ✅ 확정 |
| 전투 공식 (HP 듀얼 트랙, 진화 ×1.5+옵션 병합, 꼬리 귀환) | ✅ 확정 — `docs/design/012-combat-formulas.md` |
| 변이 시스템 (5등급 변이 풀, MUT 3축, 키메라) | ✅ 확정 — `docs/design/013-mutation-system.md` |
| 순환 상성 (A>T>G>C>A) | ✅ 확정 |
| 실험체 (12칸 결정화) | ✅ 확정 |
| CRISPR/Splicing (전투 후 Gene 삽입) | ✅ 확정 |
| Plasmid (플라스미드 12종 역설계) | ✅ 확정 — `docs/design/015-plasmid-redesign.md` |
| Expression Tree | 미착수 |
| Lab Item | 미착수 |
| 게임 구조 (하이브리드) | ✅ 방향 확정 |
| 빌드 깊이 (다층 시스템) | ✅ 방향 확정 |
| 스탯 (힘/민첩/내성/변이) | ✅ 확정 |
| 체질 (6종 계수 변경, 유전+환경) | ✅ 확정 — `docs/design/014-attribute-system.md` |
| 속성 (4속성 + 약한 상성 + 고유 효과) | ✅ 확정 |

## 씬/UI 레퍼런스

### Balatro (카드 덱빌딩 로그라이크)
- 족보(패턴) + 조커(증폭기) 2레이어 구조 → 우리의 코돈(아미노산) + 효소(조커)
- 조커 카테고리 다양성 → 패턴/조건/이벤트 3트리거
- 덱 구성 = 빌드, 핸드 = 라운드별 발동

### Slots & Daggers (슬롯머신 로그라이크)
- 슬롯머신 UI = 전투 인터페이스. 기계를 조작하는 물리적 느낌
- 심볼(=스킬) 추가/제거/업그레이드로 릴 커스터마이징 → 빌드
- 레트로 픽셀 + 물리적 기계 미학

### Mewgenics (고양이 교배 로그라이크)
- 홈(관리/교배) → 모험(전투) → 귀환(새끼 성장) 루프
- 교배: 같은 방 고양이 하루 끝에 번식. 유전/변이/특성 상속 시각화
- 캐릭터 시트: 변이/능력/계보 트리 한눈에

### 우리 씬 설계 시 적용

| 레퍼런스 | 적용 | 우리 씬 |
|---------|------|--------|
| Balatro: 족보+조커 | 코돈(아미노산)+효소(조커) 2레이어 | 전투/빌드 전체 |
| S&D: 슬롯릴 배치 느낌 | Gene을 12칸에 끼워넣기 | LabScene (빌드) |
| S&D: 레트로 기계 조작 | 연구실 = 장치 조작 톤 | 전체 UI |
| Mewgenics: 홈→모험→귀환 | 연구실→출격→귀환 루프 | 씬 전환 구조 |
| Mewgenics: 교배 유전 시각화 | Gene 상속 시각화 | BreedingScene |
| Mewgenics: 캐릭터 시트 | 실험체 정보 (잠긴 Gene, 결정화 상태) | LabScene |

## PoE 레퍼런스 데이터

`docs/reference/`에 PoE1/PoE2의 전체 아이템 데이터가 수집되어 있다. **설계 시 반드시 참조**할 것.

| 파일 | 내용 | 항목 수 |
|------|------|---------|
| `poe2-support-gems-full.md` | PoE2 서포트 젬 | 527 |
| `poe1-support-gems-full.md` | PoE1 서포트 젬 | 213 |
| `poe2-skill-gems.md` | PoE2 스킬 젬 | 335 |
| `poe1-skill-gems.md` | PoE1 스킬 젬 | 553 |
| `poe2-spirit-gems.md` | PoE2 스피릿 젬 | 53 |
| `poe2-meta-gems.md` | PoE2 메타 젬 | 63 |
| `poe2-jewels.md` / `poe1-jewels.md` | 주얼 | 21 / 17 |
| `poe2-unique-items.md` / `poe1-unique-items.md` | 유니크 아이템 | 65 / 247 |
| `poe2-currency.md` / `poe1-currency.md` | 커런시 | 37 / 97 |
| `roguelike-design-patterns.md` | Balatro/StS/Hades 설계 패턴 분석 | - |

## Conventions

- **한국어**: 문서, 커밋, 설명 모두 한국어. 코드(변수/함수명)는 영어
- **설계 제안 시 바로 수용하지 않기**: 항상 후보 방안(2~3개)과 각각의 장/단점을 먼저 제시하고, 사용자 판단을 받은 후 확정
- **설계 결정 전 반드시 사용자 확인**
- **기획 논의 시 문서 즉시 반영**: 확정 내용은 이 파일의 "확정된 설계"와 `docs/design/` 문서에 즉시 반영
- **논의 기록 원문 보존**: 설계 논의가 끝나고 다음 주제로 넘어갈 때마다, 해당 논의의 대화 내용을 `docs/discussion/NNN-제목.md`에 **최대한 원문 그대로** 기록한다. 요약하지 않는다. 후보 방안, 장/단점, 사용자 판단 근거, 최종 결정 이유가 모두 포함되어야 한다. 나중에 컨텍스트가 날아가도 논의 맥락을 복원할 수 있어야 함
- **dawchkins 기획 참조 금지**: 이전 프로젝트의 기획(Gene 흡수, 8개 성장, 4슬롯 시퀀스, 교배 간격 등)을 현재 설계에 혼입하지 않음

## 개발 방법론

### TDD (테스트 주도 개발)

- **모든 기능은 반드시 테스트 코드를 먼저 작성**하고, 그 다음 구현 코드를 작성한다
- 순서: 테스트 작성 → 실패 확인 → 구현 → 통과 확인 → 리팩터링
- 테스트 프레임워크: **Vitest** (`npm run test` / `npm run test:watch`)
- 시스템 로직(`src/systems/`)은 Phaser 의존성 없이 순수 TypeScript로 작성하여 단위 테스트 가능하게 유지
- UI 씬(`src/scenes/`)은 시스템 로직을 호출만 하고, 자체 비즈니스 로직을 갖지 않는다

### 테스트 파일 구조

```
tests/
├── data/         # 데이터 정합성 테스트
├── systems/      # 시스템 로직 단위 테스트
├── integration/  # 시스템 간 통합 테스트
└── sanity.test.ts
```

### 에이전트 팀 병렬 개발

- 기능 개발 시 **Teams를 구성하여 독립 모듈을 병렬로 개발**한다
- 의존성이 없는 모듈은 별도 에이전트에 할당하여 동시 진행
- 각 에이전트는 자기 모듈의 테스트 작성 → 구현 → 통과까지 담당
- 개발 계획: `docs/plan/development-plan.md` 참조

각 워커가 따를 5단계:

1. **Research**: 이 문서 + Phase 0 소스 코드 읽기
2. **Plan**: 태스크별 세부 구현 설계 (함수 시그니처, 로직 의사코드)
3. **Implement**: 코드 작성
4. **Review**: compound-engineering review agents 활용
5. **Compound**: `docs/solutions/` 에 학습 기록
