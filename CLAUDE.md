# CLAUDE.md

## 프로젝트 개요

**Codon** — 유전자 교배 전투 게임.

> Gene(A/T/G/C)을 조합해 코돈(스킬)을 만들고, 실험체를 빌드하고, 출격해서 전투하고, 연구실로 돌아와 빌드를 다듬고, 교배해서 다음 세대를 이어간다.

### 핵심 설계 원칙

| 원칙 | 설명 |
|------|------|
| 생물학 기반 | 실제 DNA 코돈 테이블을 게임 시스템으로 직접 차용 |
| PoE급 빌드 깊이 | 64개 코돈 조합 × 배치 전략 = 무한 빌드 |
| 심플 + 중독 | 한 출격 3~5분. "한 판만 더" |
| 아트 최소화 | 카드 아트 + 코드 이펙트. 에셋 제작 최소 |
| 세계관 = 연구실 | 스토리 없음. 실험체. 블랙유머 톤 |

## 현재 상태

- **단계**: 시스템 설계
- **플랫폼**: WebView (Phaser)
- **기술 스택**: TypeScript + Phaser + Vite

## 확정된 설계

### 용어 계층 — Gene → Codon → Sequence → Build

```
Gene (재료)       A, T, G, C 중 1개
  ↓ 3개 조합
Codon (스킬)      ATG, GCA 등 — 스킬 1개
  ↓ 3개 배치
Sequence (연결)   [코돈][코돈][코돈] — 코돈 3개짜리 세트
  ↓ N개 + 촉매
Build (빌드)      시퀀스 N개 배열 + 촉매 1개 — 최종 전투 세팅
  ↓
Battle (전투)     자동 진행 + 변이 이벤트
```

### Gene (유전자) = 염기

- **A, T, G, C** — 4종류의 염기. 게임의 기본 재료
- Gene은 스킬이 아님. 스킬을 만들기 위한 **구성 요소**
- 각 Gene에는 **하위 Gene 10종**이 존재 (총 40종). 코돈의 아미노산 효과는 동일하되, 하위 Gene이 보너스 효과를 추가
  - A(파괴): 강타/폭발/관통/침식/약화/처형/희생/선제/파쇄/과부하
  - T(생존): 보호/회복/반격/흡혈/장벽/인내/은신/적응/정화/공생
  - G(질서): 가속/정밀/안정/지속/집중/억제/공명/환경/결속/선독
  - C(혼돈): 폭주/전파/왜곡/연쇄/도발/복제/잠식/역전/기생/분열

### Codon (코돈) = 스킬

- Gene 3개를 순서대로 조합한 결과 = 코돈 = 실제 전투 스킬 1개
- 4³ = **64개** 코돈 조합 가능
- 64개 코돈 → **20개 아미노산**(효과 그룹)으로 매핑 (생물학 코돈 테이블 그대로)
- 희귀도 = 경로 수:
  - 1경로 (ATG=메티오닌, TGG=트립토판): 초희귀, 강력
  - 2경로: 조건부 강력
  - 4경로: 안정적, 범용
  - 6경로 (류신, 세린, 아르기닌): 가장 흔함, 기본 유틸
- 정지 코돈 (TAA, TAG, TGA): 스킬 비활성화 (위험/의도적 활용)

### Sequence (시퀀스) = 코돈 3개 세트

- 코돈 3개를 순서대로 배치한 것 = 스킬 콤보 1세트
- 직선 배치: [코돈1] — [코돈2] — [코돈3]
- **인접 상호작용**: 이웃한 코돈 쌍(1↔2, 2↔3)이 상호작용 → 단백질 효과 발생
  - **공명** (같은 역할: A↔A, T↔T 등): 해당 효과 증폭
  - **대립** (같은 축 반대: A↔T, G↔C): 강력하지만 불안정 (하이리스크)
  - **융합** (다른 축: A↔G, A↔C, T↔G, T↔C): 새로운 복합 효과
- 가운데 코돈이 양쪽 모두와 상호작용 → 시퀀스의 핵심
- 코돈 풀에서 3개를 골라 구성
- 실험체는 시퀀스를 여러 개 보유 가능 (시퀀스 풀)

### Build (빌드) = 전투 세팅

- **빌드 순서: 플라스미드 먼저 → 코돈/시퀀스/배열**
  1. 플라스미드 선택 (규칙 프레임 결정)
  2. 코돈 풀에서 코돈 선택
  3. 시퀀스 구성 (플라스미드 규칙에 따라 구조 변동 가능)
  4. 빌드 구성 (시퀀스 배열)
- 플라스미드가 빌드의 "규칙 프레임"을 정하고, 그 안에서 코돈/시퀀스 조합
- 연구실에서 확정. 전투 중 수정 불가
- 플라스미드 변경 시 빌드 전체 재구성 필요
- 전투 구조: 시퀀스 4개 = 코돈 12발동 (~20초)
  - Phase 1 (개시): 시퀀스 1 — 탐색/세팅
  - Phase 2 (전개): 시퀀스 2 — 본격 교전 + 이벤트 발생 구간
  - Phase 3 (전환): 시퀀스 3 — 변이 반영 + 전략 전환
  - Phase 4 (결산): 시퀀스 4 — 마무리/역전

### 풀 크기 (고정, 성장 없음)

| 항목 | 크기 | 비고 |
|------|------|------|
| 코돈 풀 | 15개 | 같은 코돈을 여러 시퀀스에서 재사용 가능 |
| 시퀀스 풀 | 6개 | 빌드 4개 + 여분 2개 (메타 대응용 교체) |
| 촉매 풀 | 4개 | 빌드 1개 + 여분 3개 (메타 대응용 교체) |
| 빌드 | 시퀀스 4개 + 촉매 1개 | 전투에 투입되는 최종 세팅 |

### PoE 대응

| 우리 시스템 | PoE 대응 | 역할 |
|------------|---------|------|
| **Gene** (A/T/G/C) | — | 스킬의 구성 재료 (염기) |
| **Codon** (Gene 3개 조합) | Skill Gem | 전투 스킬 1개 (순수 효과, 속성 없음) |
| **Sequence** (코돈 3개 세트) | Skill Link | 코돈 3개짜리 스킬 콤보 |
| **Build** (시퀀스 N개 + 촉매) | Loadout | 최종 전투 세팅 |
| **Plasmid (플라스미드)** | Keystone | 빌드의 첫 선택. 규칙 파괴형 — 기존 규칙을 변경/제거하고 새 규칙 부여 |
| **Expression Tree (발현 트리)** | Passive Tree | 빌드 특화 (TBD) |
| **Lab Item (연구실 아이템)** | Equipment | 장비 (TBD) |

### 게임 구조 — 하이브리드 (영속 연구실 + 짧은 출격)

- **로그라이크 아님**: Hades식 하이브리드. 영속 연구실 + 짧은 출격(3~5분)
- **코어 루프**: 연구실에서 빌드 → 출격(전투) → 귀환 → 빌드 조정 → 교배 → 새 실험체 → 반복
- PoE의 "마을↔맵" = 우리의 "연구실↔출격"
- 빌드 반복이 핵심 재미: 출격 결과를 보고 돌아와서 코돈/트리/장비를 조정

### 빌드 깊이 — 다층 빌드 시스템

- **Layer 0: 플라스미드 (키스톤)** — 빌드 규칙 프레임. 가장 먼저 선택. 전투/변이/상성/구조 규칙을 파괴하고 새 규칙 부여
- **Layer 1: 코돈 (스킬)** — 뭘 하느냐. 순수 효과만 가짐 (속성 없음)
- **Layer 2: 발현 트리 (패시브)** — 빌드 방향 (TBD)
- **Layer 3: 연구실 장비 (아이템)** — 특수 효과 (TBD)

### 성장 한계 — 열화 + 세대 교체

- **열화(Degradation)**: 출격할수록 실험체가 약해짐. N회 후 자연 은퇴
  - 몇 번은 빌드 조정 후 재출격 가능 → "빌드 깎는 재미" 유지
  - 언제 교배/수용할지 타이밍 판단이 전략
- **세대 교체 강제**: 일정 전투 수 이후 교배 필수
- 세부 밸런싱 미정

### 코돈 유전/보관 — B+C 혼합

- **교배 시**: 부모 코돈 일부가 자식에게 유전 (생물학적 상속)
- **은퇴 시**: 코돈이 연구실 "유전자 뱅크"에 저장 (열화 상태, 재합성 필요)
- **전투 중 사망 시**: 전부 손실
- 교배 = 최선의 코돈 전달 방법, 은퇴 = 차선 (비용 필요), 사망 = 최악
- 밸런싱: 유전자 뱅크가 무한 축적되지 않도록 제한 장치 필요 (미정)

### 코돈 역할 태그 — ATGC Gene과 별개

- 각 코돈(아미노산 효과)은 기능에 따라 **역할 태그** 1개를 가짐
- Gene 명칭(A/T/G/C)과 혼동 방지를 위해 영문 풀네임 사용

| 태그 | 역할 | 예시 코돈 |
|------|------|----------|
| **Destroy** | 파괴 | 기폭, 폭발, 침식, 관통 등 |
| **Survive** | 생존 | 경화, 재생, 반사, 결합 등 |
| **Order** | 질서 | 가속, 강직, 적응, 환경지배 등 |
| **Chaos** | 혼돈 | 반격, 변이촉발 등 |

### 전투 시스템 — 페이즈 매칭 + 조합 반응

- **빌드 = 연구실에서 확정**: 메타 정보(전체 플레이어 시퀀스 승률 데이터) 참고 → 코돈 풀에서 시퀀스 구성(코돈 선택 + 순서 배치) → 플라스미드/트리/장비 세팅 → 출격. 상대는 출격 전에 알 수 없음 (매칭은 출격 시점)
- **매칭 후 = 상대 정보 전부 공개**: 매칭되면 상대 시퀀스/스탯 등 전부 보임. 단, 빌드 수정 불가
- **전투 = 4페이즈 자동 진행**: 내 시퀀스 N vs 적 시퀀스 N. 각 페이즈 내에서 코돈 3쌍이 슬롯 대 슬롯으로 충돌 (SPD로 선후공)
- **시퀀스 내 인접 상호작용**: 코돈 3개의 인접 쌍(1↔2, 2↔3)이 공명/대립/융합 효과 생성
- **페이즈 전이 효과 (잠정)**: 각 슬롯에서 양쪽 코돈의 역할 태그 조합이 다음 페이즈 환경을 결정

| 조합 | 반응 | 다음 페이즈 효과 |
|------|------|-----------------|
| Destroy + Destroy | 폭주 | 양쪽 데미지 증가 |
| Destroy + Survive | 상쇄 | 효과 약화 |
| Destroy + Order | 집중 | 크리 확률 증가 |
| Destroy + Chaos | 임계 | 변이 확률 증가 |
| Survive + Survive | 교착 | 양쪽 방어 증가 |
| Survive + Order | 재생장 | HP 회복 효과 |
| Survive + Chaos | 침식장 | 방어 점진 감소 |
| Order + Order | 가속장 | SPD 보너스 |
| Order + Chaos | 교란장 | 버프/디버프 뒤섞임 |
| Chaos + Chaos | 혼돈장 | 양쪽 랜덤 변이 |

- 3슬롯에서 반응 3개 발생 → 가장 많은 반응이 전이 효과로 적용
- **메타게임**: 개별 상대를 카운터하는 것이 아니라, 메타(유행 시퀀스/승률)를 읽고 카운터 빌드를 짜는 구조

### 페이즈 진행 UX

```
Phase N:
  1. 양쪽 시퀀스 제출 (코돈 3쌍 공개)
  2. 변이 체크 → 발동 시: 이 시퀀스의 효과 변이 제안 → 수락/거부
  3. 전투 진행 (코돈 3쌍 충돌, SPD로 선후공)
  4. 전이 효과 계산 → 다음 Phase
```

- 4페이즈 = 4시퀀스 = 4변이 체크 (1:1 매핑)
- 변이 대상 = 해당 페이즈의 시퀀스 효과 (시퀀스 단위)
- 변이 발동 확률 = MUT / (MUT + 100) (각 페이즈마다 체크)
- **변이 = 영구**: 전투 중 수락한 변이는 시퀀스를 영구 변형 → 귀환 후 빌드 재조정 필요
- **전투가 빌드를 변화시킨다**: 연구실에서 완벽한 빌드 → 전투 중 변이로 "오염" → 귀환 후 수리/적응/재설계 = 핵심 루프

### 스탯 (Stat) — 기본 3 + 고유 1

- PoE2식 기본 스탯 + 우리 게임 고유 스탯 1개
- **힘 (STR)** → HP, 데미지
- **민첩 (DEX)** → SPD, 선공
- **내성 (RES)** → DEF, 속성 저항
- **변이 (MUT)** → 전투 중 변이 횟수, 크리티컬, 변이 품질. Mewgenics의 Luck에 대응하되 생물학 테마
### 체질 (Attribute) — 스탯 파생 비율을 변형하는 선천 특성 ⚠️ 세부 재논의 필요

- 체질 = 빌드에 영향을 주는 attribute. 같은 스탯이라도 체질에 따라 파생값이 달라짐
- 6종 확정 (이름/세부 수치는 재논의 필요):

| 체질 | 버프 | 너프 | 빌드 성격 |
|------|------|------|----------|
| **맹공** | 데미지 파생 ↑ | DEF 파생 ↓ | 글래스캐논 |
| **철벽** | DEF + 속성저항 ↑ | 데미지 파생 ↓ | 탱 |
| **신속** | SPD + 선공 ↑ | HP 파생 ↓ | 선공 제압 |
| **재생** | HP 파생 ↑ | SPD 파생 ↓ | 장기전 |
| **변이** | 변이횟수 + 크리티컬 ↑ | 내성 파생 전체 ↓ | 하이리스크 하이리턴 |
| **균형** | 보정 없음 | 보정 없음 | 범용 |

- 유전 방식, 세부 수치, 혼합 체질 가능 여부 등은 **추후 재논의**
- 키스톤급 특수 효과는 체질이 아닌 **발현 트리 최종 노드**에서 제공 예정

### ATGC 역할 — 염기쌍 2축 시스템

- 생물학적 근거: A-T 쌍, G-C 쌍 (실제 DNA base pairing)
- **A-T 축 = 뭘 하느냐** (파괴 vs 생존)
- **G-C 축 = 어떻게 하느냐** (질서 vs 혼돈)

```
     파괴(A)
       |
질서(G)—+—혼돈(C)
       |
     생존(T)
```

| 염기 | 역할 | 축 | 하위 Gene 방향 |
|------|------|-----|---------------|
| **A** (아데닌) | 파괴 | A-T (뭘) | 데미지, 관통, 약화 계열 |
| **T** (티민) | 생존 | A-T (뭘) | 방어, 회복, 보호 계열 |
| **G** (구아닌) | 질서 | G-C (어떻게) | 속도, 정밀, 안정 계열 |
| **C** (시토신) | 혼돈 | G-C (어떻게) | 변이, 크리, 교란 계열 |

- 코돈의 3글자가 2축 위의 성격을 결정: "A+C가 많은 코돈 = 파괴적+혼돈스러운", "T+G가 많은 코돈 = 생존+질서"
- 하위 Gene 설계 시 각 염기의 역할이 방향을 결정

### 속성 — 4속성 + 약한 상성 + 고유 효과

- PoE식 고유 효과 + 포켓몬식 약한 상성 혼합
- 상성 배율은 낮게 (~1.2배) → 빌드 실력이 상성을 이길 수 있음
- 속성은 플라스미드를 통해 코돈에 부여됨 (Gene 자체에는 속성 없음)

| 속성 | 고유 효과 | 강함 (+20%) | 약함 (-20%) |
|------|----------|------------|------------|
| **Fire** | 점화 (지속 데미지) | vs Plant | vs Water |
| **Water** | 둔화 (SPD 감소) | vs Fire | vs Earth |
| **Earth** | 경화 (DEF 증가) | vs Water | vs Plant |
| **Plant** | 재생 (HP 회복) | vs Earth | vs Fire |

```
Fire > Plant > Earth > Water > Fire (약한 상성)
각 속성은 고유 효과로 전략 차별화
```

### Plasmid (플라스미드) = 빌드 키스톤

- **빌드의 첫 번째 선택**. 플라스미드가 전투/변이/상성/구조 규칙을 변경 → 그 규칙 안에서 코돈/시퀀스 조합
- **규칙 파괴형**: "X를 포기/변경하는 대신 Y를 얻는다". 숫자 버프 아님 (숫자 보너스는 하위 Gene 담당)
- **빌드당 1개**, 촉매 풀 4개에서 선택
- **PoE 키스톤에 대응**: 빌드 정체성을 결정하는 핵심 선택

| # | 이름 | 카테고리 | 규칙 변경 | 빌드 성격 |
|---|------|---------|----------|----------|
| 1 | **역행** | 전투 | SPD 선후공 제거 → 슬롯 역순 발동 | 후공 코돈 역발상 |
| 2 | **공명체** | 전투 | 인접 상호작용 제거 → 3코돈 같은 역할 태그면 ×3 | 올인 빌드 |
| 3 | **거울** | 전투 | 내 시퀀스 배열 무효 → 상대 시퀀스 복사 (하위 Gene만 내 것) | 카운터 특화 |
| 4 | **선독** | 전투 | Phase 1~3 전투 제거 → Phase 4만 전투, 위력 ×4 | 원샷 빌드 |
| 5 | **불안정 서열** | 변이 | 수락/거부 제거 → 자동 수락 + 확률 2배 | 카오스 빌드 |
| 6 | **순수 서열** | 변이 | 변이 시스템 제거 → 스탯 파생 +20% | 안정형 |
| 7 | **적응체** | 변이 | 변이 영구 제거 → 전투 중만 적용, 효과 ×0.5 | 빌드 오염 방지 |
| 8 | **무속성** | 속성 | 상성 제거 → 항상 ×1.0 + 순수 데미지 +30% | 브루트포스 |
| 9 | **키메라** | 속성 | 단일 속성 제거 → 코돈마다 랜덤 속성 + 유리 시 ×1.5 | 도박형 |
| 10 | **과부하** | 구조 | 코돈 3→2/시퀀스, 페이즈 4→5 | 다회전 빌드 |
| 11 | **압축** | 구조 | 4페이즈 → 2페이즈 (페이즈당 코돈 6개 충돌) | 폭발력 집중 |
| 12 | **기생체** | 메타 | 상대 플라스미드 무효화 + 탈취 | 메타 카운터 |

- 세부 수치 밸런싱은 개발 후 테스트로 조정

### 시퀀스 빌드 UI — 데이터 표시 가이드

개발 시 코돈/시퀀스 빌드 화면에서 아래 형식으로 데이터가 보여야 함:

```
[AAA 선제]            — [CTA 가속]            — [ATG 기폭★]
 선공 시 위력 ×1.3       SPD +20%               위력 ×2.0
 A-선제(선공+20% 추가)   C-폭주(크리+10%)       A-과부하(이전 뎀 있으면 +10%)
 A-강타(위력+15%)        T-은신(회피 1회)       T-흡혈(흡혈 10%)
 A-관통(DEF-10% 무시)    A-처형(적HP<30%+30%)   G-가속(SPD+5%)

코돈1: 40×1.3×1.15×1.2×0.84 = 60.3 뎀 (선공 보장)
코돈2: SPD +20% (36→43.2) + 크리+10% + 회피 1회 (뎀 없음)
코돈3: 40×2.0×1.1×0.74 = 65.1 뎀 (+과부하, 흡혈 6.5)

시퀀스 합계: ~125 뎀 + SPD 버프 + 회피
융합 보너스: Destroy+Order → "집중" → 크리확률 전체 +10%
```

표시 항목:
- 코돈 3개: 코돈명 + 아미노산명 + 희귀도(★) + 아미노산 효과 설명
- 하위 Gene 보너스: 각 코돈의 3개 Gene 자리별 하위 Gene + 구체 수치
- 코돈별 예상 수치: 데미지 공식 전개 + 최종값
- 시퀀스 합계: 총 뎀/회복/버프 요약
- 인접 상호작용: 공명/대립/융합 + 보너스 효과

### 미확정 (논의 필요)

- 체질 세부 설계: 유전 방식, 수치 밸런싱, 혼합 체질 여부 (⚠️ 재논의 필요)
- 플라스미드 밸런싱: 12종 후보 확정, 세부 수치 미정. 획득 방법, 교배 시 유전 여부 미정
- 돌연변이: 변이 시스템의 재설계
- 수집/자랑 요소: PoE 유니크 아이템에 대응하는 수집 요소 (gene 등급이 아닌 다른 방식)
- 크래프팅: 교배 자체를 크래프팅으로 볼 것인지, 별도 시스템 필요한지
- Expression Tree: 미설계
- Lab Item: 미설계
- 열화 세부 수치: 몇 회 출격 후 은퇴인지, 열화 곡선
- 유전자 뱅크 제한 장치: 저장 한도, 재합성 비용

## 설계 진행 상황

| 카테고리 | 상태 |
|----------|------|
| Gene (염기 정의) | 완료 (A/T/G/C 4종 × 하위 Gene 10종 = 40종) |
| Codon (64개 → 20효과 매핑) | 완료 (순수 효과, 속성 없음) |
| Plasmid (플라스미드) | 확정 (규칙 파괴형 12종, 빌드 첫 선택, 수치 밸런싱 미정) |
| Expression Tree | 미착수 |
| Lab Item | 미착수 |
| 게임 구조 (하이브리드) | 방향 확정 |
| 빌드 깊이 (다층 시스템) | 방향 확정, 세부 미설계 |
| 성장 한계 (열화+세대교체) | 방향 확정, 수치 미정 |
| 코돈 유전/보관 (B+C 혼합) | 방향 확정, 밸런싱 미정 |
| 전투 시스템 (시퀀스+변이) | 방향 확정, 판정 공식 미정 |
| 스탯 (힘/민첩/내성/변이) | 확정 |
| 체질 (6종 방향 확정) | ⚠️ 세부 재논의 필요 |
| ATGC 역할 (2축: 파괴/생존 × 질서/혼돈) | 확정 |
| 속성 (4속성 + 약한 상성 + 고유 효과) | 확정 |

## 씬/UI 레퍼런스

### Slots & Daggers (슬롯머신 로그라이크)
- 슬롯머신 UI = 전투 인터페이스. 기계를 조작하는 물리적 느낌
- 심볼(=스킬) 추가/제거/업그레이드로 릴 커스터마이징 → 빌드
- 3매칭 = 크리티컬. 심볼 과다 시 원하는 조합 안 나옴 = 전략
- 레트로 픽셀 + 물리적 기계 미학

### Mewgenics (고양이 교배 로그라이크)
- 홈(관리/교배) → 모험(전투) → 귀환(새끼 성장) 루프
- 교배: 같은 방 고양이 하루 끝에 번식. 유전/변이/특성 상속 시각화
- 전투: 그리드 기반 턴제 (4마리 파티)
- 캐릭터 시트: 변이/능력/계보 트리 한눈에

### 우리 씬 설계 시 적용

| 레퍼런스 | 적용 | 우리 씬 |
|---------|------|--------|
| S&D: 슬롯릴 배치 느낌 | 코돈 풀에서 시퀀스에 코돈 끼워넣기 | LabScene (빌드) |
| S&D: 레트로 기계 조작 | 연구실 = 장치 조작 톤 | 전체 UI |
| Mewgenics: 홈→모험→귀환 | 연구실→출격→귀환 루프 | 씬 전환 구조 |
| Mewgenics: 교배 유전 시각화 | Gene/코돈 상속 시각화 | BreedingScene |
| Mewgenics: 캐릭터 시트 | 실험체 정보 패널 | LabScene |

## PoE 레퍼런스 데이터

`docs/reference/`에 PoE1/PoE2의 전체 아이템 데이터가 수집되어 있다. **설계 시 반드시 참조**할 것.

| 파일 | 내용 | 항목 수 |
|------|------|---------|
| `poe2-support-gems-full.md` | PoE2 서포트 젬 | 527 |
| `poe1-support-gems-full.md` | PoE1 서포트 젬 | 213 |
| `poe2-skill-gems.md` | PoE2 스킬 젬 | 335 |
| `poe1-skill-gems.md` | PoE1 스킬 젬 | 553 |
| `poe2-spirit-gems.md` | PoE2 스피릿 젬 | 53 |
| `poe2-meta-gems.md` | PoE2 메타 젬 | 63 |
| `poe2-jewels.md` / `poe1-jewels.md` | 주얼 | 21 / 17 |
| `poe2-unique-items.md` / `poe1-unique-items.md` | 유니크 아이템 | 65 / 247 |
| `poe2-currency.md` / `poe1-currency.md` | 커런시 | 37 / 97 |
| `roguelike-design-patterns.md` | Balatro/StS/Hades 설계 패턴 분석 | - |

## Conventions

- **한국어**: 문서, 커밋, 설명 모두 한국어. 코드(변수/함수명)는 영어
- **설계 제안 시 바로 수용하지 않기**: 항상 후보 방안(2~3개)과 각각의 장/단점을 먼저 제시하고, 사용자 판단을 받은 후 확정
- **설계 결정 전 반드시 사용자 확인**
- **기획 논의 시 문서 즉시 반영**: 확정 내용은 이 파일의 "확정된 설계"와 `docs/design/` 문서에 즉시 반영
- **논의 기록 원문 보존**: 설계 논의가 끝나고 다음 주제로 넘어갈 때마다, 해당 논의의 대화 내용을 `docs/discussion/NNN-제목.md`에 **최대한 원문 그대로** 기록한다. 요약하지 않는다. 후보 방안, 장/단점, 사용자 판단 근거, 최종 결정 이유가 모두 포함되어야 한다. 나중에 컨텍스트가 날아가도 논의 맥락을 복원할 수 있어야 함
- **dawchkins 기획 참조 금지**: 이전 프로젝트의 기획(Gene 흡수, 8개 성장, 4슬롯 시퀀스, 교배 간격 등)을 현재 설계에 혼입하지 않음

## 개발 방법론

### TDD (테스트 주도 개발)

- **모든 기능은 반드시 테스트 코드를 먼저 작성**하고, 그 다음 구현 코드를 작성한다
- 순서: 테스트 작성 → 실패 확인 → 구현 → 통과 확인 → 리팩터링
- 테스트 프레임워크: **Vitest** (`npm run test` / `npm run test:watch`)
- 시스템 로직(`src/systems/`)은 Phaser 의존성 없이 순수 TypeScript로 작성하여 단위 테스트 가능하게 유지
- UI 씬(`src/scenes/`)은 시스템 로직을 호출만 하고, 자체 비즈니스 로직을 갖지 않는다

### 테스트 파일 구조

```
tests/
├── data/         # 데이터 정합성 테스트
├── systems/      # 시스템 로직 단위 테스트
├── integration/  # 시스템 간 통합 테스트
└── sanity.test.ts
```

### 에이전트 팀 병렬 개발

- 기능 개발 시 **Teams를 구성하여 독립 모듈을 병렬로 개발**한다
- 의존성이 없는 모듈은 별도 에이전트에 할당하여 동시 진행
- 각 에이전트는 자기 모듈의 테스트 작성 → 구현 → 통과까지 담당
- 개발 계획: `docs/plan/development-plan.md` 참조

각 워커가 따를 5단계:

1. **Research**: 이 문서 + Phase 0 소스 코드 읽기
2. **Plan**: 태스크별 세부 구현 설계 (함수 시그니처, 로직 의사코드)
3. **Implement**: 코드 작성
4. **Review**: compound-engineering review agents 활용
5. **Compound**: `docs/solutions/` 에 학습 기록
