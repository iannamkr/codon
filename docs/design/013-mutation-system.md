# 013. 변이 시스템 (Mutation System)

## 1. 핵심 개념

전투 중 특정 트리거 달성 시, 실험체의 **MUT 스탯**에 따라 돌연변이 팝업이 발생한다.
유저는 프리뷰를 보고 **[수락/거부]**를 선택. 수락 시 해당 Gene은 **영구 잠김(★)** 처리.

### 왜 필요한가

새 전투 구조(012)에서 이미 진화/프레임시프트/꼬리 귀환이 빌드를 변형하지만,
이것들은 **예측 가능한** 변형이다. 변이 시스템은 **예측 불가능한** 변형을 추가:

| 기존 메커니즘 | 성격 | 변이 시스템 |
|-------------|------|-----------|
| 동종 진화 (A+A=A⁺) | 예측 가능, 유저가 배치로 유도 | **점변이/키메라** → 예상 못한 타입 변경 |
| 프레임시프트 | 예측 가능, 소멸 위치에 따라 결정 | **전위/역위** → 유저가 직접 서열 조작 |
| Gene 소멸 | 영구적 손실 | **중복** → 소멸을 되돌리는 기적 |

→ 변이 = **전투가 빌드를 예측 불가능하게 비트는 시스템** + **유저에게 선택권**

### 핵심 원칙

- 변이는 **제안**이다 — 유저가 거부할 수 있음
- 수락한 변이는 **영구적** — 귀환 후에도 유지, 해당 Gene 잠김
- MUT이 높을수록 **더 자주, 더 강한, 더 많은 선택지**
- 변이는 양날의 검 — 서열을 구원할 수도, 망칠 수도 있음

---

## 2. 변이 풀 (Mutation Pool) — 5등급

### 흔함: 점변이 (Point Mutation)

| 항목 | 내용 |
|------|------|
| 요구 MUT | 10+ |
| 생물학 | 염기 치환 (Substitution) |
| 트리거 | **페이즈 전환 시** (3라운드마다) |
| 효과 | 서열 내 Gene 1개의 **타입(A/T/G/C)을 랜덤 변경** |
| 프리뷰 | "G₃ → C₃로 변환? (코돈 판정: AGC→ACC로 변경)" |
| 잠김 | 변경된 Gene 1개 잠김 |

**세부 규칙:**
- 변경 대상: 현재 윈도우(3칸) 내의 잠기지 않은 Gene 중 랜덤 1개
- 변경 타입: 원래 타입을 제외한 3종 중 랜덤 (MUT 50+ 시 유저가 3종 중 선택)
- 하위Gene: 변경 시 같은 하위Gene 인덱스 유지 (예: A의 3번째(관통) → T의 3번째(반격))
- 코돈 영향: 타입 변경 → 코돈 판정이 바뀜 → 아미노산 효과 변경 (핵심!)

```
예: 윈도우 [A][T][G] = ATG(★기폭/메티오닌)
    점변이: G→C 수락
    결과: [A][T][C★] = ATC(침투/이소류신) — 전설급 코돈이 희귀급으로!
    또는: A→C 수락
    결과: [C★][T][G] = CTG(신경독 가시/류신) — 완전히 다른 효과!
```

### 보통: 역위 (Inversion)

| 항목 | 내용 |
|------|------|
| 요구 MUT | 30+ |
| 생물학 | DNA 구간 반전 |
| 트리거 | **탈진 데미지 발생 시** (서열 1회전 완료) |
| 효과 | 현재 윈도우 3칸의 **Gene 순서를 완전히 뒤집음** |
| 프리뷰 | "[G-A-A] → [A-A-G]로 역위? (코돈: GAA→AAG로 변경)" |
| 잠김 | 뒤집힌 3칸 모두 잠김 |

**세부 규칙:**
- 윈도우 내에 이미 잠긴 Gene이 있어도 역위 가능 (위치만 바뀜, 이미 잠긴 건 유지)
- 역위 후 코돈 판정 즉시 재계산
- 탈진 데미지 자체는 정상 적용 (역위가 탈진을 막지 않음)

```
예: 윈도우 [G][A][A] = GAA(군집 페로몬/글루탐산)
    역위 수락
    결과: [A★][A★][G★] = AAG(탐식의 턱/라이신) — 완전히 다른 아미노산!
    → 유저: "코돈이 꼬여서 망했는데 역위로 살았다!"
```

### 희귀: 전위 (Transposition)

| 항목 | 내용 |
|------|------|
| 요구 MUT | 50+ |
| 생물학 | 트랜스포존 (Jumping Gene) |
| 트리거 | **프레임시프트 발생 시** |
| 효과 | 내 서열 내 **멀리 떨어진 Gene 2개의 위치를 교환** |
| 프리뷰 | "G₃ ↔ C₉ 교환? (코돈1: ATG→ATC, 코돈3: TTC→TTG)" |
| 잠김 | 교환된 Gene 2개 모두 잠김 |

**세부 규칙:**
- 교환 대상: 잠기지 않은 Gene 중 랜덤 2개 (서로 다른 윈도우에 위치해야 함)
- MUT 70+ 시 유저가 교환할 Gene 2개를 직접 지정 가능
- 프레임시프트로 서열이 압축된 직후 발동 → 교환이 새 코돈 판정에 반영

```
예: 서열 [...G₃...C₉...]
    전위: G₃ ↔ C₉ 수락
    결과: [...C₃★...G₉★...]
    → 코돈 두 개가 동시에 변경! 빌드 대변동
```

### 영웅: 중복 (Duplication)

| 항목 | 내용 |
|------|------|
| 요구 MUT | 70+ |
| 생물학 | 유전자 중복 (Gene Duplication) |
| 트리거 | **내 Gene이 파괴될 때** |
| 효과 | 파괴된 Gene 자리에 **양옆 인접 Gene 중 하나를 복사**해서 채움 |
| 프리뷰 | "A₂ 파괴! 인접 [강타A₁] 또는 [가속G₃] 중 하나를 복사?" |
| 잠김 | 복사된 Gene 잠김 (원본은 잠기지 않음) |

**세부 규칙:**
- 인접 Gene이 양쪽에 있으면 유저가 선택, 한쪽만 있으면 자동 (서열 끝)
- 복사본은 원본과 동일 (타입 + 하위Gene 모두 복사)
- 복사본은 즉시 잠김(★), 원본은 잠기지 않음
- 파괴가 "취소"되는 효과 — Gene 수가 줄어들지 않으므로 프레임시프트 방지!
- 동종 진화 기회 증가: 인접에 같은 타입 Gene을 복사하면 동종 진화 노림 가능

```
예: [강타A₁][보호T₂][가속G₃], T₂ 파괴 시
    중복: A₁ 복사 수락
    결과: [강타A₁][강타A₂★][가속G₃]
    → 프레임시프트 방지 + A 동종 진화 기회!
```

### 전설: 키메라 (Chimera)

| 항목 | 내용 |
|------|------|
| 요구 MUT | 90+ |
| 생물학 | 이종 결합 / 수평 유전자 전달 |
| 트리거 | **상성 승리 시** |
| 효과 | 파괴한 적 Gene의 **타입 + 하위Gene을 내 Gene에 강제 흡수**, 이중 타입 Gene 생성 |
| 프리뷰 | "강타A₁이 보호T를 흡수! → [강타A+보호T]⁺ 키메라 생성?" |
| 잠김 | 키메라 Gene 잠김 |

**세부 규칙:**

키메라 Gene = 이중 타입(Dual-Type). 게임 내 유일한 이중 타입 존재.

#### 키메라의 상성 판정

```
[AT⁺ 키메라] — A와 T 양쪽 타입을 보유

공격 시 (내가 상대를 칠 때):
  유리한 쪽으로 판정 — A>T, T>G 중 상대에게 유리한 타입 자동 선택
  → AT⁺ vs G → T>G로 판정 (승리)
  → AT⁺ vs C → A는 C에 약함, T는 C와 비상성 → T로 판정 (비상성 동등)

수비 시 (상대가 나를 칠 때):
  불리한 쪽도 노출 — 상대가 A 또는 T 중 약점을 공략 가능
  → C vs AT⁺ → C>A로 판정 (패배)
  → G vs AT⁺ → G는 A에 약함, G는 T에 약함 → 패배 확정
```

**요약: 키메라는 공격 시 유리, 수비 시 약점 노출 = 양날의 검**

#### 키메라의 동종 진화

- AT⁺ + A → 동종 판정 (A 쪽으로 매칭) → 진화 시 A⁺ (T 하위Gene은 추가 옵션으로 병합)
- AT⁺ + T → 동종 판정 (T 쪽으로 매칭) → 진화 시 T⁺
- AT⁺ + AT⁺ → 완전 동종 → AT⁺⁺ (초레어)
- AT⁺ + GC⁺ → 4타입 키메라는 불가 → 상성 판정으로 전투

#### 키메라의 코돈 판정

- 키메라 Gene은 코돈 판정 시 **1차 타입**(원래 내 Gene)으로 취급
- 예: [AT⁺]가 코돈 윈도우에 있으면 A로 판정
- 하위Gene은 양쪽 모두 보유 (강타A + 보호T = 공격+방어 동시)

```
예: 내 [강타A₁] vs 적 [보호T]
    상성 승리(A>T) + 키메라 변이 발동!
    수락: [강타A+보호T]₁★ 키메라 생성
    → 코돈 판정: A로 취급 (1차 타입)
    → 전투: 공격 시 A 상성 + T 상성 중 유리한 쪽 자동 선택
    → 하위Gene: 강타(데미지+15%) + 보호(아군 쉴드) 동시 보유!
```

---

## 3. MUT 스탯 역할 — 3축 제어

### 축 1: 발동 빈도 (Frequency)

트리거 이벤트 발생 시 변이 확률:

```
변이 확률 = MUT / (MUT + 100)

MUT  10 →  9% (전투당 ~1회)
MUT  30 → 23% (전투당 ~3회)
MUT  50 → 33% (전투당 ~5회)
MUT  80 → 44% (전투당 ~7회)
MUT 100 → 50% (전투당 ~8회)
```

트리거 이벤트 수 추정 (12 vs 12 기준):
- 페이즈 전환: ~4회
- 프레임시프트: ~3~5회
- Gene 파괴: ~6~8회
- 탈진 데미지: ~2~3회
- 상성 승리: ~4~6회
- **합계: ~15~25회 트리거**

### 축 2: 변이 품질 (Quality)

MUT이 높을수록 상위 등급 변이 등장 확률 증가:

```
변이 등급 결정 (가중 랜덤):

MUT 10~29:  점변이 80%, 역위 15%, 전위 5%
MUT 30~49:  점변이 40%, 역위 35%, 전위 20%, 중복 5%
MUT 50~69:  점변이 20%, 역위 25%, 전위 30%, 중복 20%, 키메라 5%
MUT 70~89:  점변이 10%, 역위 15%, 전위 25%, 중복 30%, 키메라 20%
MUT 90+:    점변이 5%,  역위 10%, 전위 20%, 중복 30%, 키메라 35%
```

단, 요구 MUT 미달 등급은 등장 불가 (MUT 20이면 역위 이상 등장 불가).

### 축 3: 선택지 수 (Critical)

변이 팝업 시 제시되는 선택지 수:

```
MUT < 50:   항상 1개 (이거 할래 말래?)
MUT 50~79:  30% 확률로 2개 (A할래 B할래?)
MUT 80+:    50% 확률로 2개, 15% 확률로 3개
```

복수 선택지 = 유저 통제력 ↑. 고MUT 빌드의 핵심 보상.

---

## 4. 수락/거부 메커니즘

### UI 팝업

```
┌─── 돌연변이 발생! ───────────────────────┐
│                                          │
│  🧬 역위 (Inversion)                     │
│                                          │
│  현재: [G][A][A] = GAA (군집 페로몬)      │
│  변이: [A][A][G] = AAG (탐식의 턱)        │
│                                          │
│  ⚠️ 수락 시 3칸 모두 영구 잠김(★)         │
│                                          │
│  [수락]                    [거부]          │
└──────────────────────────────────────────┘
```

### 전투 일시정지

- 변이 팝업 발생 시 전투 일시정지 (유저 판단 시간)
- 제한 시간 없음 (PvP 도입 시 10초 타이머 추가 가능)
- 거부 시 패널티 없음 — 단순히 "이번 변이를 무시"

### 연속 변이

- 같은 트리거에서 변이가 연속 발동할 수 있음 (고MUT)
- 연속 발동 시 한 번에 모아서 표시 (큐 방식)
- 먼저 발동한 변이의 수락/거부 결과가 다음 변이 프리뷰에 반영

---

## 5. 잠김 규칙

| 변이 타입 | 잠기는 Gene 수 | 대상 |
|----------|--------------|------|
| 점변이 | 1개 | 타입 변경된 Gene |
| 역위 | 3개 | 뒤집힌 윈도우 전체 |
| 전위 | 2개 | 교환된 Gene 2개 |
| 중복 | 1개 | 복사본 (원본은 잠기지 않음) |
| 키메라 | 1개 | 키메라 Gene |

**중요: 이미 잠긴 Gene도 변이 대상이 될 수 있음** (잠김 ≠ 변이 면역)
- 잠긴 Gene의 타입이 점변이로 바뀔 수 있음 → "잠김"은 유저의 자유 편집만 차단
- 변이는 "자연의 힘"이므로 잠김을 무시

---

## 6. 플라스미드 연동

기존 3종 변이 관련 플라스미드가 이 시스템과 직접 연동:

### 불안정 서열 (Unstable Sequence)

```
수락/거부 제거 → 모든 변이 자동 수락
변이 확률 2배: MUT / (MUT + 100) → MUT / (MUT + 50)
추가: 변이 팝업 시 선택지 항상 +1개

MUT 50 + 불안정 서열:
  확률: 50/100 = 50% (기본 33%)
  선택지: 항상 2개 이상
  → "자동 수락인데 선택지는 늘어남" = 카오스지만 통제 가능한 카오스
```

### 순수 서열 (Pure Sequence)

```
변이 시스템 완전 비활성화
대신: 전 스탯 파생 +20%

→ 변이 리스크 제거, 안정적 빌드. MUT 스탯이 완전히 죽는 대신 다른 스탯이 강해짐
```

### 적응체 (Adaptive)

```
변이 영구성 제거 → 수락해도 전투 중만 적용, 귀환 시 원복
대신: 변이 효과 ×0.5

→ 변이를 "시험 삼아" 사용 가능. 잠김 리스크 없음. 효과가 절반이지만 빌드 오염 방지
```

---

## 7. 효소 시너지

011 효소 중 변이와 시너지되는 효소들:

| 효소 | 시너지 |
|------|--------|
| **돌연변이 안정제** (🟣 패턴) | Chaos 아미노산 발동 시 → 다음 변이의 선택지 +1개 |
| **유전자 재조합 칵테일** (🟣 이벤트) | Gene 패배 시 10% 역전 → 키메라와 유사한 "적 흡수" 효과 |
| **불안정 동위원소** (🟣 조건) | C Gene 2개+ 시 → 변이 확률 추가 보너스 |
| **DNA 시퀀스 스캐너** (🔵 이벤트) | 프레임시프트 시 코돈 최적화 → 전위와 시너지 (원하는 Gene을 이동) |

---

## 8. 전투 시뮬레이션 (변이 포함)

```
═══ 설정 ═══
내 실험체: STR 25, MUT 60, HP 130
내 서열: [강타A₁][보호T₂][가속G₃] [정밀G₄][폭주C₅][흡혈T₆] [반격A₇][장벽T₈][연쇄C₉] [관통A₁₀][강타A₁₁][왜곡C₁₂]
효소: [돌연변이 안정제] [피의 펌프 모터] [극저온 동결 캡슐] [A-스테로이드 앰플]

적 실험체: STR 30, HP 140
적 서열: [보호T][폭발A][정화T] [적응G][침식A][은신T] [가속G][반격C][흡혈T] [강타A][회복T][왜곡C]

═══ Phase 1 (윈도우: 강타A₁/보호T₂/가속G₃ = ATG ★기폭!) ═══

라운드1: 강타A₁ vs 보호T → A>T 상성 승리!
         기본 10 + 강타(+15%) = 11.5 → 적 HP: 140→128.5
         모터 누적: +2

         🧬 변이 체크 (MUT 60, 상성 승리 트리거):
         확률 60/160 = 37.5% → 성공!
         등급 롤: MUT 60 → 전위(30%) 당첨!
         "전위: G₃ ↔ C₉ 교환하시겠습니까?"
         → 현재 윈도우 [A₁][T₂][G₃]=ATG(기폭) → [A₁][T₂][C₉]=ATC(기생 포자)
         → 유저: 기폭 잃기 싫음. [거부]

라운드2: 보호T₂ vs 폭발A → T<A 상성 패배!
         적 기본 10 + 폭발(+20%) = 12 → 내 HP: 130→118
         보호T₂ 파괴

         🧬 변이 체크 (MUT 60, Gene 파괴 트리거):
         확률 37.5% → 실패

라운드3: 가속G₃ vs 정화T → 비상성(G vs T = 동등)
         양쪽 Survivor Pool → 서열 끝으로

═══ Phase 전환 → 변이 체크 ═══

🧬 변이 체크 (MUT 60, 페이즈 전환 트리거):
확률 37.5% → 성공!
등급 롤: MUT 60 → 점변이(20%) 당첨
선택지: MUT 60 → 30% 확률로 2개 → 성공! 2개 제시

"점변이 선택지:
  A) G₄ → A₄로 변환 (윈도우: AGC→AAC = 잠복성 바이러스!)
  B) G₄ → C₄로 변환 (윈도우: AGC→ACC = ??)
  어느 쪽?"

→ 유저: 잠복성 바이러스 좋다! [A 수락]
→ G₄★ 잠김, 이제 A₄★

═══ Phase 2 (윈도우: A₄★/폭주C₅/흡혈T₆ = ACT = 반응성 굳은살) ═══
... (전투 계속) ...

═══ 후반: 탈진 데미지 ═══

1회전 완료, 탈진 5 데미지
🧬 변이 체크 (MUT 60, 탈진 트리거):
확률 37.5% → 성공!
등급 롤: MUT 60 → 역위(25%) 당첨

"역위: 현재 윈도우 [C₅][A₇][A₁₁] → [A₁₁][A₇][C₅]로 뒤집기?"
→ 유저: A₁₁과 A₇이 앞으로 오면 동종 진화 노릴 수 있다! [수락]
→ [A₁₁★][A₇★][C₅★] 3칸 잠김
→ 코돈: AAC(잠복성 바이러스!) 발동!
→ "코돈이 꼬여서 망했는데 역위로 살았다!" 🎉
```

---

## 9. 확정된 설계 결정

### ✅ 키메라 이중 타입 상성 규칙

- **공격: 유리한 타입으로 자동 판정** (양날의 유리)
- **수비: 약점 타입도 노출** (양날의 불리)
- **코돈 판정: 1차 타입(원래 내 Gene)으로 취급** — 윈도우 스캔 로직 깔끔, 유저 예측 가능
- **동종 진화: 어느 쪽 타입으로든 동종 매칭 가능**

→ "본질은 A지만, 고기로 엮어놓은 T의 무기를 쓴다" = 하이리스크 하이리턴

### ✅ 변이 횟수 상한 없음 (소프트 캡)

- Hard Cap 없음 — MUT 확률로 자연 제한
- **소프트 캡 = 12칸 잠김**: 수락할 때마다 Gene이 잠기므로, 12칸이 물리적 상한
- 고MUT 카오스 빌드의 극한 경험 보장: MUT 100 올인 → 전투 내내 변이 팝업 폭풍

### ✅ 잠긴 Gene도 변이 대상

- 잠김(★) = 유저의 자유 편집만 차단. 변이(자연의 힘)는 잠김을 무시
- **핵심 근거: 망한 결정화의 유일한 구원줄**
  - 쓰레기 코돈으로 굳어버린 잠긴 Gene을 변이로 구제 가능
  - 거부 선택지가 있으므로 완벽하게 깎아놓은 Gene은 무시하면 됨 → 불쾌감 없음
- 테마 부합: "통제할 수 없는 생물학적 진화"

### 변이 이력 UI (전투 종료 후)

전투 종료 시 "이번 전투의 변이 기록" 화면 표시:
- 발생한 변이 목록 (수락/거부 표시)
- 잠긴 Gene 위치
- 코돈 변경 before/after

---

## 변경 이력

| 날짜 | 내용 |
|------|------|
| 2026-02-19 | 초안 작성 — C+B 하이브리드 5등급 변이 풀, MUT 3축 제어, 키메라 이중 타입 |
| 2026-02-19 | 3건 확정: 키메라 상성(양날의 검), 상한 없음(소프트캡=12칸), 잠김 Gene 변이 가능(구원줄) |
